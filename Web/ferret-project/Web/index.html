<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">    
<!-- no cache headers -->
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="no-cache">
<meta http-equiv="Expires" content="-1">
<meta http-equiv="Cache-Control" content="no-cache">
<!-- end no cache headers -->
    <head>    
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>        
        <script src="js/vendor/jquery-min.js"></script>
        <link rel="stylesheet" href="css/bootstrap337.min.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link rel="stylesheet" type="text/css" href="js/papaya/Papaya-master/build/papaya.css" />
        <script type="text/javascript" src="js/papaya/Papaya-master/build/papaya.js"></script>
        <link rel="stylesheet" type="text/css" href="js/vendor/slick-1.6.0/slick/slick.css"/>
        <link rel="stylesheet" type="text/css" href="js/vendor/slick-1.6.0/slick/slick-theme.css"/>
        <link rel="stylesheet" type="text/css" href="js/vendor/css/slider.css"/>
        <link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.css"/>
        <link rel="stylesheet" type="text/css" src="js/vendor/treed/treed.css">
        <link rel="stylesheet" href="css/mriatlases_layout.css" />
        <title>National Institutes of Health - National Institute of Biomedical Imaging and Bioengineering - Quantitative Medical Imaging - MRI Atlases</title>
        <script src="js/vendor/bootstrap-min.js"></script>
        <script src="js/vendor/jquery1124-min.js"></script>        
        <script type="text/javascript" src="js/vendor/slick-1.6.0/slick/slick.min.js"></script>
        <script type="text/javascript" src="js/vendor/jquery-migrate-121-min.js"></script>
        <script type="text/javascript" src="js/vendor/jquery-1110-min.js"></script>
        <script type="text/javascript" src="js/vendor/bootstrap-slider.js"></script>
        <script type="text/javascript" src="js/vendor/BootstrapValidator.min.js"></script>
        <script type="text/javascript" src="js/vendor/papaparse.js"></script>
        <script type="text/javascript" src="js/typeahead.js"></script>
        <script type="text/javascript" src="js/UIManager.js"></script>                
        <script type="text/javascript" src="js/vendor/chartjs-2.7.0/Chart.bundle.min.js"></script>
        <script type="text/javascript" src="js/ChartHelper.js"></script>                
        <script type="text/javascript" src="js/ContextManager.js"></script>
    </head>        
    <body>       
        <nav id="navi" class="navbar navbar-inverse" aria-label="nothing here">        
          <div class="container-fluid"  ><div class="navbar-header"><div class="navbar-brand"></div></div></div>
        </nav>               
        <div id="bannerBox" class="pager" style="width:100%;margin:0">
            <img src="img/banner_full.png" alt="Ferret brain web viewer main banner." style="width:100%;" />
            <div id="attentionMessage" class="list-group">
              <a class="list-group-item active-inverse">
                <div class="jumbotron">
                    <button class="btn btn-primary list-group-item-text" id="visualization_screen">Browse Templates</button>
                    <p class="list-group-item-text"></p>
                    <p class="list-group-item-text"></p>
                    <button class="btn btn-primary list-group-item-text" id="about_screen">About</button>
                </div>
              </a>
            </div>
        </div>                             
        <div class="container-fluid" id="mri_headers">               
            <div class="row">
                 <div class="col-sm-2">                    
                    <h2 class="well well-lg">Templates</h2>
                 </div>
                 <div class="col-sm-8">                 
                     <h2 class="well well-lg">Viewer</h2>
                 </div>
                 <div class="col-sm-2">              
                    <h2 class="well well-lg">Info</h2>   
                 </div>
            </div>
        </div>
        <!--            LEFT NAV BAR            -->     
        <div class="container-fluid" id="template_content">        
            <div id="template_nav1" class="row">
                <div class="col-sm-2">
                    <div class="well">
                        <div class="btn-group-vertical btn-block" data-toggle="buttons">
                            <label class="btn btn-primary active" id="evdti_group" ><input type="radio" name="options" autocomplete="off" checked> Ex-Vivo DTI </label>
                            <label class="btn btn-success" id="evt2_group"><input type="radio" name="options" autocomplete="off"> Ex-Vivo T2 </label>
                            <label class="btn btn-danger" id="ivdti_group" ><input type="radio" name="options" autocomplete="off"> In-Vivo DTI </label>
                            <label class="btn btn-warning" id="ivt2_group" ><input type="radio" name="options" autocomplete="off"> In-Vivo T2 </label>
                            <label class="btn btn-info" id="segmentation_group" ><input type="radio" name="options" autocomplete="off"> Segmentation </label>
                        </div>
                        <br>   
                        <div><hr></div>                     
                        <div class="btn-group-vertical btn-block" id="evdti_modality_buttons">
                            <button type="button" class="btn btn-primary btn-outline" id="ex_vivo_dti_fa" data-toggle="tooltip" title="Fractional Anisotropy">FA</button>
                            <button type="button" class="btn btn-primary btn-outline" id="ex_vivo_dti_tr">Trace</button>
                            <button type="button" class="btn btn-primary btn-outline" id="ex_vivo_dti_dec" data-toggle="tooltip" title="Directionally Encoded Color Map">DEC Map</button>
                        </div>
                        <div class="btn-group-vertical btn-block" id="evt2_modality_buttons">
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_10" data-toggle="tooltip" title="Echo Time (milliseconds)">10 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_20" data-toggle="tooltip" title="Echo Time (milliseconds)">20 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_30" data-toggle="tooltip" title="Echo Time (milliseconds)">30 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_40" data-toggle="tooltip" title="Echo Time (milliseconds)">40 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_50" data-toggle="tooltip" title="Echo Time (milliseconds)">50 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_60" data-toggle="tooltip" title="Echo Time (milliseconds)">60 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_70" data-toggle="tooltip" title="Echo Time (milliseconds)">70 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_80" data-toggle="tooltip" title="Echo Time (milliseconds)">80 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_90" data-toggle="tooltip" title="Echo Time (milliseconds)">90 ms</button>
                            <button type="button" class="btn btn-success btn-outline" id="ex_vivo_T2_100" data-toggle="tooltip" title="Echo Time (milliseconds)">100 ms</button>
                        </div>                        
                        <div class="btn-group-vertical btn-block" id="ivdti_modality_buttons">
                            <button type="button" class="btn btn-danger btn-outline" id="in_vivo_dti_fa" data-toggle="tooltip" title="Fractional Anisotropy">FA</button>
                            <button type="button" class="btn btn-danger btn-outline" id="in_vivo_dti_tr">Trace</button>
                            <button type="button" class="btn btn-danger btn-outline" id="in_vivo_dti_dec" data-toggle="tooltip" title="Directionally Encoded Colormap">DEC Map</button>
                        </div>
                        <div class="btn-group-vertical btn-block" id="ivt2_modality_buttons">
                            <button type="button" class="btn btn-warning btn-outline" id="in_vivo_T2_12" data-toggle="tooltip" title="Echo Time (milliseconds)">12 ms</button>
                            <button type="button" class="btn btn-warning btn-outline" id="in_vivo_T2_36" data-toggle="tooltip" title="Echo Time (milliseconds)">36 ms</button>
                            <button type="button" class="btn btn-warning btn-outline" id="in_vivo_T2_60" data-toggle="tooltip" title="Echo Time (milliseconds)">60 ms</button>
                            <button type="button" class="btn btn-warning btn-outline" id="in_vivo_T2_84" data-toggle="tooltip" title="Echo Time (milliseconds)">84 ms</button>
                        </div>
                        <div class="btn-group-vertical btn-block" id="segmentation_modality_buttons">
                            <button type="button" class="btn btn-info btn-outline" id="ev_dti_segmentation" data-toggle="tooltip" title="Use right panel to explore ex-vivo DTI data">Ex-Vivo DTI</button>
                            <button type="button" class="btn btn-info btn-outline disabled" id="iv_dti_segmentation" data-toggle="tooltip" title="Use right panel to explore in-vivo DTI data">In-Vivo DTI</button>
                        </div>
                    </div>
                </div>                  
                <div class="col-sm-8" id="MRI_area1">
                    <div class="jumbotron" id="view_container" >                                                               
                        <div id="ex_vivo_dti_viewer" style="width:58vw;">
                            <div id="papaya1" class="papaya" data-params="params1"></div>
                        </div>
                        <div id="in_vivo_dti_viewer" style="width:58vw;">
                            <div id="papaya2" class="papaya" data-params="params2"></div>
                        </div>
                        <div id="ex_vivo_t2_viewer" style="width:58vw;">
                            <div id="papaya3" class="papaya" data-params="params3"></div>
                        </div>
                        <div id="in_vivo_t2_viewer" style="width:58vw;">
                            <div id="papaya4" class="papaya" data-params="params4"></div>
                        </div>                            
                    </div>
                </div>                            
                <!--            RIGHT NAV BAR            -->                
                <div class="col-sm-2" id="template_nav2">                                  
                    <div class="well">
<!--
                        <form class="form-inline">
                            <div class="form-group mx-sm-3">
                                <label class="form-control-static" for="query">Search for an ROI:</label>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" title="query" aria-label="search bar" name="query" id="query" placeholder="Enter ROI name"/>
                            </div>
                            <div class="form-group">
                                <button id="search_roi" class="btn btn-success" type="button">Go</button>
                            </div>
                        </form>          
-->              
                        <p>Modality</p>
                        <div class="btn-group  btn-group-justified" data-toggle="buttons">
                          <label id="modality_ev_roi" class="btn btn-primary active">
                            <input type="radio" name="options" id="option2" autocomplete="off" checked="true"> ROI </input>
                          </label>
                          <label id="modality_fa" class="btn btn-primary">
                            <input type="radio" name="options" id="option1" autocomplete="off"> FA </input>
                          </label>
                          <label id="modality_tr" class="btn btn-primary">
                            <input type="radio" name="options" id="option2" autocomplete="off"> TR </input>
                          </label>                                  
                        </div>
                        <div id="atlas_analysis">
                            <hr>
                            <p>Statistics</p>
                            <div id="roi_stats">
                                <div id="img_description"></div>
                                <div id="current_roi"></div>
                                <div id="voxel_value"></div>
                                <div id="roi_volume"></div>
                                <div id="roi_mean"></div>
                                <div id="roi_std_dev"></div>
                                <div id="roi_description"></div>
                            </div>                            
                        </div>
                        <div id="histogram_container" >
                            <hr>
                            <p>Histogram</p>
                            <div id="plot_area">
                                <canvas id="RoiChart"></canvas>
                            </div>
                        </div>
                    </div>    
                </div>                   
            </div>
       </div>       
       <div class="col-sm-8 col-sm-push-2 container-fluid" id="about_containter">
        <div class="jumbotron" id="about_content"  style="width:58vw;">            
        </div>
       </div>       
       <div id="form_modal" class="modal fade ">
              <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">MRI Atlases</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true"></span>
                    </button>
                  </div>
                  <div id="modal_body_content" class="modal-body">
                  <form class="well form-horizontal" action=" " method="post"  id="contact_form">
        <fieldset>
        <!-- Form Name -->
        <legend>Data request form</legend>
        <!-- Text input-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="first_name">First Name</label>  
          <div class="col-md-4 inputGroupContainer">
          <div class="input-group">
          <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
          <input  id="first_name" name="first_name" placeholder="First Name" class="form-control"  type="text"/>
            </div>
          </div>
        </div>
        <!-- Text input-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="first_name">Last Name</label> 
            <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
          <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
          <input id="last_name" name="last_name" placeholder="Last Name" class="form-control"  type="text"/>
            </div>
          </div>
        </div>
        <!-- Text input-->
               <div class="form-group">
          <label class="col-md-4 control-label" for="email">E-Mail</label>  
            <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
                <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
          <input id="email" name="email" placeholder="E-Mail Address" class="form-control"  type="text"/>
            </div>
          </div>
        </div>       
        <!-- Text input-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="institution">Institution</label>  
           <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
                <span class="input-group-addon"><i class="glyphicon glyphicon-globe"></i></span>
          <input id="institution" name="institution" placeholder="Institution name" class="form-control" type="text"/>
            </div>
          </div>
        </div>
        <!-- Text area -->
        <div class="form-group">
          <label class="col-md-4 control-label" for="message">Usage Description: </label>
            <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
                <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                	<textarea id="comment" class="form-control" name="comment" placeholder="Usage Description..."></textarea>
          </div>
          </div>
        </div>
        <!-- Success message -->       
        <div class="alert alert-success" role="alert" id="success_message_request">Success <i class="glyphicon glyphicon-thumbs-up"></i> Thanks for contacting us, we will get back to you shortly.</div>
        <!-- Button -->
        <div class="form-group">
          <label class="col-md-4 control-label"></label>
          <div class="col-md-4">
            <button type="submit" class="btn btn-warning" >Send <span class="glyphicon glyphicon-send"></span></button>
          </div>
        </div>
        </fieldset>
        </form>
        </div>
        </div>
        </div>
        </div>        
        <!-- roi feedback form -->>
        <div id="feedback_modal" class="modal fade ">
              <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">MRI Atlases</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true"></span>
                    </button>
                  </div>
                  <div id="modal_body_content" class="modal-body">
                  <form class="well form-horizontal" action=" " method="post"  id="feedback_form">
        <fieldset>
        <!-- Form Name -->
        <legend>ROI Feedback form</legend>
        <!-- Text input-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="first_name">First Name</label>  
          <div class="col-md-4 inputGroupContainer">
          <div class="input-group">
          <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
          <input  id="first_name" name="first_name" placeholder="First Name" class="form-control"  type="text"/>
            </div>
          </div>
        </div>
        <!-- Text input-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="first_name">Last Name</label> 
            <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
          <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
          <input id="last_name" name="last_name" placeholder="Last Name" class="form-control"  type="text"/>
            </div>
          </div>
        </div>
        <!-- Text input-->
               <div class="form-group">
          <label class="col-md-4 control-label" for="email">E-Mail</label>  
            <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
                <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
          <input id="email" name="email" placeholder="E-Mail Address" class="form-control"  type="text"/>
            </div>
          </div>
        </div>       
        <!-- Text input-->
        <div class="form-group">
          <label class="col-md-4 control-label" for="institution">Institution</label>  
           <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
                <span class="input-group-addon"><i class="glyphicon glyphicon-globe"></i></span>
          <input id="institution" name="institution" placeholder="Institution name" class="form-control" type="text"/>
            </div>
          </div>
        </div>
        <!-- Text area -->
        <div class="form-group">
          <label class="col-md-4 control-label" for="message">ROI Description: </label>
            <div class="col-md-4 inputGroupContainer">
            <div class="input-group">
                <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                	<textarea id="comment" class="form-control" name="comment" placeholder="<ROI Name> &nbsp;- <ROI Description...>"></textarea>
          </div>
          </div>
        </div>
        <!-- Success message -->       
        <div class="alert alert-success" role="alert" id="success_message_roi">Success <i class="glyphicon glyphicon-thumbs-up"></i> Thanks for submitting your suggestion, we will get back to you shortly.</div>
        <!-- Button -->
        <div class="form-group">
          <label class="col-md-4 control-label"></label>
          <div class="col-md-4">
            <button type="submit" class="btn btn-warning" >Send <span class="glyphicon glyphicon-send"></span></button>
          </div>
        </div>
        </fieldset>
        </form>
        </div>
        </div>
        </div>
        </div>
    <!-- /.container -->
        <div id="loading" class="centered">
            <div class="loading spin-1">
                <div class="loading spin-2">
                    <div class="loading spin-3">
                        <div class="loading spin-4">
                            <div class="loading spin-5">
                                <div class="loading spin-6"></div>
                            </div>            
                        </div>            
                    </div>            
                </div>            
            </div>            
        </div>
        <script type="text/javascript">
            var params  = [];
            var params1 = [];
            var params2 = [];
            var params3 = [];
            var params4 = [];  
            var ch = new ChartHelper();
            var ui = new UIManager();            
            var ctx = new ContextManager();
            ui.SetChartHelper(ch);            
            ctx.SetChartHelper(ch);
            var current_image ="";                     
            var brain_region_struct = {};            
            //var imageUrl = 'img/test_bkg.jpg'; //  Image credit - http://combiboilersleeds.com               
            var imageUrl = 'img/black_minimal_bkg.jpg';
            
            var checkFile = function(fname) {
	                    filename = fname.trim();
	
	                    var response = jQuery.ajax({
		                    url: filename,
		                    type: 'HEAD',
		                    async: false
	                    }).status;	
	
	                    return (response != "200") ? false : true;
                    };
            
            $(document).ready(function(){
            //$('ul.sub').hide();
             $('body, html').css('background-image', 'url(' + imageUrl + ')');                                
                ui.hideDivs([
                      "#ex_vivo_dti_viewer",
                      "#in_vivo_dti_viewer",
                      "#ex_vivo_t2_viewer",
                      "#in_vivo_t2_viewer",                                    
                      "#navi", 
                      "#MRI_area1", 
                      "#visualization_templates", 
                      "#bannerBox",  
                      "#mri_headers","#template_content",     
                      "#evt2_modality_buttons", 
                      "#ivdti_modality_buttons", "#ivt2_modality_buttons", 
                      "#segmentation_modality_buttons",
                      "#template_nav2",
                      "#histogram_container",
                      "#roi_volume", "#roi_mean", "#roi_std_dev",
                      "#about_containter", "#success_message_request",
                      "#success_message_roi",
                ]);                
                //  tbd change 300 to screen height derived percentage
                ch.CreateChart("RoiChart", 300);                  
                setTimeout(function(){
                    var fileExists = checkFile("img/linked_content/Templates/DTI_exvivo/Volumes/ExVivo_DTI_FA.nii");
                    if(fileExists){
                        console.log("first image file loaded. now check for the last image file.");
                        if(checkFile("img/linked_content/Templates/T2_invivo/Volumes/ivT2_TE084.nii")){
                            console.log("last image file loaded. show the rest of the page.");
                            ui.swapDivs( ["#loading"],[   "#navi", "#bannerBox" ], "slow"); 
                        } else {
                            console.log("last image file not loaded. reload the page.");
                            window.location.reload(true);
                        }
                    } else {
                        console.log("first image file not loaded. reload the page.");
                        window.location.reload(true);
                    }
                }, 3000);         
                ui.FetchBrainRegionData(); 
            });
        </script>        
    </body>
</html>
